# 花火撮影レンズ計算ツール（iPhoneアプリ）

花火撮影に最適なレンズmm数を計算し、構図をプレビューできるiOSアプリケーションです。

## 機能

- **レンズmm数計算**: 撮影地から花火までの距離と花火の号数を入力すると、最適なレンズmm数を自動計算
- **構図プレビュー（正面図）**: リアルタイムで撮影イメージを視覚的に確認
- **側面図**: 横から見た時のカメラの画角範囲と花火の位置関係を表示
- **地上の割合調整**: 地上部分の割合を調整して構図を最適化
- **花火の号数選択**: 3号から30号まで、9種類の号数から選択可能
- **センサーサイズ対応**: フルサイズ、APS-C、マイクロフォーサーズに対応

## 使い方

1. Xcodeでプロジェクトを開く
2. iPhoneシミュレーターまたは実機で実行
3. スライダーとピッカーで以下の値を調整：
   - **撮影地から花火までの距離**（50-5000m）
   - **地上の割合**（0-100%）
   - **花火の号数**（3号、4号、5号、6号、7号、8号、10号、20号、30号）
   - **センサーサイズ**（フルサイズ、APS-C、マイクロフォーサーズ）
4. 推奨レンズmm数がリアルタイムで表示され、プレビューで構図を確認

## 計算式

レンズmm数は以下の式で計算されます：

```
打ち上げ高さ = 選択した号数の上がる高さ（m）
開いた直径 = 選択した号数の開いたときの直径（m）

花火の上端 = 打ち上げ高さ + 開いた直径 / 2
花火の下端 = max(0, 打ち上げ高さ - 開いた直径 / 2)
花火の実際の高さ = 花火の上端 - 花火の下端

空の割合 = (100 - 地上の割合) / 100
花火の高さを収める画角 = 2 × arctan(花火の実際の高さ / (2 × 距離))
実効画角 = 花火の高さを収める画角 / 空の割合
レンズmm = (センサー高さ / 2) / tan(実効画角 / 2)
```

### 計算のポイント

- **花火の号数に基づく計算**: 3号から30号まで、9種類の号数に対応
- **打ち上げ高さと開いた直径を考慮**: 各号数の上がる高さと開いたときの直径のデータを使用
- **センサーサイズ対応**: フルサイズ、APS-C、マイクロフォーサーズに対応
- **花火全体が画面に収まる**: 花火が開いた時の範囲（中心から上下に直径/2ずつ）が空の部分に収まるように計算

## プロジェクト構成

- `FireworksLensCalculatorApp.swift` - アプリエントリーポイント
- `ContentView.swift` - メインビュー（入力UIと結果表示）
- `LensCalculator.swift` - レンズmm数計算ロジック
- `PreviewView.swift` - 構図プレビュー描画（正面図）
- `SideView.swift` - 側面図描画（横から見たイメージ）
- `Info.plist` - アプリ設定

## 技術仕様

- **プラットフォーム**: iOS 17.0以上
- **フレームワーク**: SwiftUI
- **言語**: Swift 5.0
- **デバイス**: iPhone、iPad対応

## ビルド方法

1. Xcode 15.0以上を開く
2. `FireworksLensCalculator.xcodeproj`を開く
3. シミュレーターまたは実機を選択
4. ⌘Rでビルド＆実行

## 花火の号数データ

| 号数 | 名称 | 上がる高さ（m） | 開いたときの直径（m） |
|------|------|----------------|----------------------|
| 3号 | 3号玉 | 120 | 60 |
| 4号 | 4号玉 | 160 | 130 |
| 5号 | 5号玉 | 190 | 170 |
| 6号 | 6号玉 | 220 | 220 |
| 7号 | 7号玉 | 250 | 240 |
| 8号 | 8号玉 | 280 | 280 |
| 10号 | 10号玉 | 330 | 320 |
| 20号 | 20号玉 | 500 | 480 |
| 30号 | 30号玉 | 600 | 550 |

## 特徴

- **花火の号数に対応**: 3号から30号まで、9種類の号数に対応し、実際の打ち上げ花火の諸元データを使用
- **カメラセンサー対応**: フルサイズ、APS-C、マイクロフォーサーズに対応
- **リアルタイム更新**: スライダーやピッカーを動かすと即座に計算結果とプレビューが更新
- **2つの視点**: 正面図と側面図の両方で撮影イメージを確認可能
  - **正面図**: カメラから見た構図（空と地面の割合、花火の位置）
  - **側面図**: 横から見たイメージ（カメラの画角範囲、花火の高さ範囲、距離関係）
- **正確な計算**: 各号数の打ち上げ高さと開いた直径を考慮した正確なレンズmm数計算
