# 花火撮影レンズ計算ツール（iPhoneアプリ）

花火撮影に最適なレンズmm数を計算し、構図をプレビューできるiOSアプリケーションです。

## 機能

- **レンズmm数計算**: 撮影地から花火までの距離を入力すると、最適なレンズmm数（35mm換算）を自動計算
- **構図プレビュー**: リアルタイムで撮影イメージを視覚的に確認
- **地上の割合調整**: 地上部分の割合を調整して構図を最適化
- **花火の広がり考慮**: 打ち上げ高さと開いた時の広がり（最大4尺）を考慮した正確な計算
- **iPhone最適化**: iPhoneのセンサーサイズに基づいた計算と35mm換算表示

## 使い方

1. Xcodeでプロジェクトを開く
2. iPhoneシミュレーターまたは実機で実行
3. スライダーで以下の値を調整：
   - **撮影地から花火までの距離**（50-5000m）
   - **地上の割合**（0-100%）
   - **花火の打ち上げ高さ**（50-1000m、一般的には200-400m）
   - **花火が開いた時の広がり**（0-4尺、1尺 ≈ 3.03m）
4. 推奨レンズmm数がリアルタイムで表示され、プレビューで構図を確認

## 計算式

レンズmm数は以下の式で計算されます：

```
花火の広がり（m）= 広がり（尺）× 3.03
花火の上端 = 打ち上げ高さ + 広がり/2
花火の下端 = max(0, 打ち上げ高さ - 広がり/2)  // 地上より下にならない
花火の高さ = 花火の上端 - 花火の下端
総高さ = 花火の上端（地上から花火の上端まで）

空の割合 = (100 - 地上の割合) / 100
花火の高さを収める画角 = 2 × arctan(花火の高さ / (2 × 距離))
実効画角 = 花火の高さを収める画角 / 空の割合
iPhoneレンズmm = (iPhoneセンサー高さ / 2) / tan(実効画角 / 2)
35mm換算 = iPhoneレンズmm × (35mmセンサー対角線 / iPhoneセンサー対角線)
```

### 計算のポイント

- **花火の広がりを考慮**: 打ち上げ高さだけでなく、開いた時の広がり（最大4尺）も考慮
- **花火全体が画面に収まる**: 花火の上端から下端までが空の部分に収まるように計算
- **35mm換算表示**: iPhoneの実際の焦点距離を35mm換算で表示（一般的なレンズmm数と比較可能）

## プロジェクト構成

- `FireworksLensCalculatorApp.swift` - アプリエントリーポイント
- `ContentView.swift` - メインビュー（入力UIと結果表示）
- `LensCalculator.swift` - レンズmm数計算ロジック
- `PreviewView.swift` - 構図プレビュー描画
- `Info.plist` - アプリ設定

## 技術仕様

- **プラットフォーム**: iOS 17.0以上
- **フレームワーク**: SwiftUI
- **言語**: Swift 5.0
- **デバイス**: iPhone、iPad対応

## ビルド方法

1. Xcode 15.0以上を開く
2. `FireworksLensCalculator.xcodeproj`を開く
3. シミュレーターまたは実機を選択
4. ⌘Rでビルド＆実行

## 特徴

- **花火の広がりを考慮**: 打ち上げ高さだけでなく、開いた時の広がり（最大4尺）も考慮した正確な計算
- **リアルタイム更新**: スライダーを動かすと即座に計算結果とプレビューが更新
- **視覚的なプレビュー**: Canvasを使用した美しい構図プレビュー
- **35mm換算表示**: 一般的なレンズmm数（35mm換算）で表示
